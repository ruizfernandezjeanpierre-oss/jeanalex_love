<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>El Libro Infinito de Naomi üíñ</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body{
background: radial-gradient(circle at top,#1e1b4b,#0f172a);
overflow:hidden;
}
.page{
animation: pageTurn 0.8s ease;
}
@keyframes pageTurn{
from{transform: rotateY(-15deg); opacity:0;}
to{transform: rotateY(0); opacity:1;}
}
.scroll{
max-height:55vh;
overflow-y:auto;
}
</style>
</head>

<body class="flex items-center justify-center min-h-screen text-white p-4">

<div class="bg-white/10 backdrop-blur-xl rounded-3xl shadow-2xl p-8 max-w-3xl w-full text-center">

<h1 class="text-3xl text-pink-400 mb-6">
üìñ El Libro Infinito de Naomi
</h1>

<div id="content" class="space-y-4 page"></div>

</div>

<!-- üéµ M√∫sica -->
<audio id="musicFeliz" loop src="https://cdn.pixabay.com/audio/2022/03/15/audio_c8f3fef8c5.mp3"></audio>
<audio id="musicSonadora" loop src="https://cdn.pixabay.com/audio/2022/10/25/audio_3e7a8d28a1.mp3"></audio>
<audio id="musicTranquila" loop src="https://cdn.pixabay.com/audio/2022/11/03/audio_7f6a3e.mp3"></audio>
<audio id="musicNostalgica" loop src="https://cdn.pixabay.com/audio/2022/08/04/audio_2c2f63.mp3"></audio>

<script>

const content=document.getElementById("content");
let step=0;
let answers={};
let currentStory="";

/* =================== INICIO =================== */

content.innerHTML=`
<p>Este libro escribe historias seg√∫n tu coraz√≥n üíñ</p>
<button onclick="next()" class="bg-pink-500 px-6 py-3 rounded-xl hover:scale-110 transition">
Comenzar ‚ú®
</button>
`;

/* =================== FLUJO =================== */

function next(){
step++;
content.classList.add("page");

if(step===1) ask("¬øC√≥mo te sientes hoy?",
["feliz","so√±adora","tranquila","nostalgica"],
"mood");

else if(step===2) ask("¬øQu√© escenario prefieres?",
["estrellas","flores","mar","lluvia"],
"place");

else if(step===3) ask("¬øC√≥mo es nuestro amor?",
["eterno","intenso","dulce","magico"],
"love");

else if(step===4) generateStory();
}

function ask(text,options,key){
let html=`<p>${text}</p><div class="grid gap-3 mt-4">`;
options.forEach(o=>{
html+=`<button onclick="save('${key}','${o}')" 
class="bg-purple-500 p-2 rounded-xl hover:scale-110 transition">
${o}
</button>`;
});
html+="</div>";
content.innerHTML=html;
}

function save(key,val){
answers[key]=val;
next();
}

/* =================== M√öSICA =================== */

function playMusic(){
document.querySelectorAll("audio").forEach(a=>a.pause());
if(answers.mood==="feliz") musicFeliz.play();
if(answers.mood==="so√±adora") musicSonadora.play();
if(answers.mood==="tranquila") musicTranquila.play();
if(answers.mood==="nostalgica") musicNostalgica.play();
}

/* =================== GENERADOR =================== */

function pick(arr){
return arr[Math.floor(Math.random()*arr.length)];
}

function generateStory(){

playMusic();

let cap1 = `
Cap√≠tulo I ‚Äì El Inicio

${pick([
"Todo comenz√≥ con un suspiro del universo.",
"El destino decidi√≥ escribir algo distinto esa noche.",
"Hab√≠a una historia esperando nacer.",
"El tiempo se detuvo por un instante."
])}

${pick([
"El aire estaba lleno de promesas.",
"El cielo parec√≠a observar en silencio.",
"El mundo respiraba suavemente.",
"Las estrellas brillaban con intenci√≥n."
])}
`;

let cap2 = `
Cap√≠tulo II ‚Äì El Encuentro

${pick([
"En medio del escenario elegido, apareci√≥ Naomi.",
"All√≠, entre luces suaves, caminaba Naomi.",
"Fue entonces cuando ella apareci√≥.",
"Y como si el universo lo supiera, Naomi lleg√≥."
])}

${pick([
"Sus ojos reflejaban mundos enteros.",
"Su sonrisa cambiaba la atm√≥sfera.",
"Su presencia transformaba todo.",
"Su energ√≠a iluminaba cada rinc√≥n."
])}

${pick([
"Nada volvi√≥ a ser igual desde ese momento.",
"El silencio se convirti√≥ en m√∫sica.",
"El mundo pareci√≥ entender algo profundo.",
"El destino tom√≥ un nuevo rumbo."
])}
`;

let cap3 = `
Cap√≠tulo III ‚Äì Lo Que Se Descubre

${pick([
"Con el paso del tiempo, comprendi√≥ algo esencial.",
"Cada latido tra√≠a una revelaci√≥n.",
"Entre momentos simples naci√≥ algo eterno.",
"Los d√≠as comenzaron a tener otro significado."
])}

Nuestro amor es ${answers.love}.
No es casualidad.
No es pasajero.
Es una historia que se construye cada d√≠a.
Es un refugio.
Es una promesa silenciosa.
Es algo que el universo protege.
`;

let cap4 = `
Cap√≠tulo IV ‚Äì Lo Infinito

${pick([
"Y as√≠ contin√∫a nuestra historia.",
"Desde entonces seguimos escribiendo cap√≠tulos.",
"Cada d√≠a es una nueva p√°gina.",
"El libro a√∫n tiene muchas p√°ginas por llenar."
])}

Porque cuando dos almas se encuentran as√≠,
el tiempo no importa,
la distancia no asusta,
y el amor siempre encuentra su camino.

Fin‚Ä¶ por ahora üíñ
`;

currentStory = `${cap1}\n${cap2}\n${cap3}\n${cap4}`;

saveStory(currentStory);

content.innerHTML=`
<div class="scroll text-left whitespace-pre-line text-pink-200 leading-relaxed page">
${currentStory}
</div>

<div class="flex flex-wrap justify-center gap-4 mt-6">
<button onclick="exportPDF()" class="bg-green-500 px-4 py-2 rounded-xl hover:scale-110 transition">
Exportar PDF üñ®Ô∏è
</button>

<button onclick="viewSaved()" class="bg-blue-500 px-4 py-2 rounded-xl hover:scale-110 transition">
Ver cuentos guardados üíæ
</button>

<button onclick="location.reload()" class="bg-pink-500 px-4 py-2 rounded-xl hover:scale-110 transition">
Crear otro üìñ
</button>
</div>
`;
}

/* =================== GUARDADO =================== */

function saveStory(story){
let stories=JSON.parse(localStorage.getItem("naomiStories"))||[];
stories.push(story);
localStorage.setItem("naomiStories",JSON.stringify(stories));
}

function viewSaved(){
let stories=JSON.parse(localStorage.getItem("naomiStories"))||[];
if(stories.length===0){
alert("A√∫n no hay cuentos guardados üíñ");
return;
}
content.innerHTML=`
<div class="scroll text-left whitespace-pre-line text-pink-200">
${stories.join("\n\n------------------------\n\n")}
</div>
<button onclick="location.reload()" 
class="bg-pink-500 mt-6 px-4 py-2 rounded-xl">
Volver
</button>
`;
}

/* =================== PDF =================== */

async function exportPDF(){
const { jsPDF } = window.jspdf;
let doc = new jsPDF();
doc.text(currentStory,10,10,{maxWidth:180});
doc.save("Cuento_Naomi.pdf");
}

</script>
</body>
</html>
